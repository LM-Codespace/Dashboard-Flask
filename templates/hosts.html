{% extends "base.html" %}
{% block content %}
    <h1>Hosts</h1>
    <p>Manage known and unknown devices on your network.</p>

    <!-- Add Host Form -->
    <h2>Add New Host</h2>
    <form method="POST" action="/hosts">
        <label for="hostname">Hostname</label>
        <input type="text" id="hostname" name="hostname" required>

        <label for="ip_address">IP Address</label>
        <input type="text" id="ip_address" name="ip_address" required>

        <label for="os">Operating System</label>
        <input type="text" id="os" name="os" required>

        <input type="submit" value="Add Host">
    </form>


    <!-- Bulk Upload Form -->
    <h2>Bulk Upload IP Ranges</h2>
    <form method="POST" action="/hosts/bulk_csv" enctype="multipart/form-data">
        <div class="form-group">
            <label for="csv_file">CSV File (start_ip,end_ip format):</label>
            <input type="file" class="form-control" id="csv_file" name="csv_file" accept=".csv" required>
            <small class="form-text text-muted">
                Example CSV content:<br>
                100.43.72.0,100.43.72.255<br>
                102.222.77.0,102.222.77.255
            </small>
        </div>

        <div class="form-group">
            <label for="os">Operating System (for all hosts):</label>
            <input type="text" class="form-control" id="os" name="os" required>
        </div>

        <button type="submit" class="btn btn-primary">Upload and Process</button>
    </form>
<table class="host-table">
    <thead>
        <tr>
            <th>
                <a href="{{ url_for('hosts', sort='ip_address', direction=('asc' if sort == 'ip_address' and direction == 'desc' else 'desc')) }}">
                    IP Address
                    {% if sort == 'ip_address' %}
                        {% if direction == 'desc' %}↓{% else %}↑{% endif %}
                    {% endif %}
                </a>
            </th>
            <th>
                <a href="{{ url_for('hosts', sort='hostname', direction=('asc' if sort == 'hostname' and direction == 'desc' else 'desc')) }}">
                    Hostname
                    {% if sort == 'hostname' %}
                        {% if direction == 'desc' %}↓{% else %}↑{% endif %}
                    {% endif %}
                </a>
            </th>
            <th>Ports</th>
            <th>
                <a href="{{ url_for('hosts', sort='last_scanned', direction=('asc' if sort == 'last_scanned' and direction == 'desc' else 'desc')) }}">
                    Last Scanned
                    {% if sort == 'last_scanned' %}
                        {% if direction == 'desc' %}↓{% else %}↑{% endif %}
                    {% endif %}
                </a>
            </th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for host in hosts %}
        <tr>
            <td>{{ host.ip_address }}</td>
            <td>{{ host.hostname if host.hostname else 'N/A' }}</td>
            <td>
                {% if host.ports %}
                    {{ host.ports|replace(",", ", ") }}
                {% else %}
                    Not scanned
                {% endif %}
            </td>
            <td>
                {% if host.last_scanned %}
                    {{ host.last_scanned.strftime('%Y-%m-%d %H:%M') }}
                {% else %}
                    Never
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('edit_host', id=host.id) }}" class="btn-edit">Edit</a> | 
                <a href="{{ url_for('delete_host', id=host.id) }}" class="btn-delete" onclick="return confirm('Are you sure?')">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<!-- After your hosts table -->
<div class="pagination">
    {% if pagination.has_prev %}
        <a href="{{ url_for('hosts', page=pagination.page-1) }}">Previous</a>
    {% endif %}
    
    <span>Page {{ pagination.page }} of {{ pagination.pages }}</span>
    
    {% if pagination.has_next %}
        <a href="{{ url_for('hosts', page=pagination.page+1) }}">Next</a>
    {% endif %}
</div>
{% endblock %}
