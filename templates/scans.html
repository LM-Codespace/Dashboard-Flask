{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>Security Scans</h1>
    <p>Run scans and manage reports from this dashboard.</p>

    <!-- Sub Navigation -->
    <div class="subnav">
        <a href="{{ url_for('scans.run_scan_view') }}" class="subnav-link">Run New Scan</a>
        <a href="{{ url_for('scans.scan_history') }}" class="subnav-link">Scan History</a>
        <a href="{{ url_for('scans.reports') }}" class="subnav-link">Reports</a>

    </div>

    <!-- New Scan Form -->
    <div class="scan-form">
        <h3>Run a New Scan</h3>
        <form action="{{ url_for('scans.run_scan') }}" method="POST">
            <div class="form-group">
                <!-- Select Hosts to Scan -->
                <label for="hosts">Select Hosts:</label><br>
                {% for host in hosts %}
                    <input type="checkbox" name="hosts" value="{{ host.id }}"> {{ host.name }} ({{ host.ip }})<br>
                {% endfor %}
                <br>

                <!-- Select Scan Type -->
                <label for="scan_type">Select Scan Type:</label><br>
                <select name="scan_type">
                    <option value="hostname">Hostname Resolution</option>
                    <option value="port_check">Port Check (80, 443)</option>
                </select>
                <br>

                <button type="submit" class="btn">Start Scan</button>
            </div>
        </form>
    </div>

    <!-- Recent Scans Table -->
    <div class="scan-table">
        <h3>Recent Scans</h3>
        <table class="styled-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Target</th>
                    <th>Scan Type</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Report</th>
                </tr>
            </thead>
            <tbody>
                {% for scan in recent_scans %}
                    <tr>
                        <td>{{ scan.id }}</td>
                        <td>{{ scan.target }}</td>
                        <td>{{ scan.scan_type }}</td>
                        <td>{{ scan.status }}</td>
                        <td>{{ scan.date }}</td>
                        <td>
                            {% if scan.status == 'completed' %}
                                <a href="{{ url_for('scans.view_report', scan_id=scan.id) }}" class="btn btn-small">View</a>
                            {% else %}
                                <span>Pending</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
